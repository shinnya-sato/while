# 変更履歴

2021-07-05
- v1.3.8 としてリリース
- デバッグモードの「戻る」操作をしていると、手続き呼び出し前後で環境が戻せないことがあった。手続きによる参照呼びのための思い付きの方法として参照呼びの名前用スタックを使っていたが、どうもタイミングが合わないらしい。なぜ合わないのかはわからないが、この操作を SECD の C に含めるようにして解消した（本来はそうすべきだったと思う）。
- エラーメッセージをクリックすると、該当行へカーソルを自動で移動させるようにした。
- デバッグモードの環境表示にて、更新があった場合にはセル枠を光らせるアニメーションを付けてみた。
- アニメーションの使い方が分かってきた。下記が詳しい：
https://www.mfitzp.com/tutorials/qpropertyanimation/



2021-07-04

- str("-1") で負数に変換されていた不具合を修正（負数のときは 0 にした）。
- 検索、置換小窓を表示にアニメーション効果を付けた。



2021-07-03

- v1.3.7 としてリリース

- 置換機能を実装し、編集メニューに加えた。
- [TODO エディタ関連]
	- エラー行を分かりやすく表示したい => 2021-07-05追記：エラーメッセージをクリックすると該当行へフォーカスが移るようにした。



2021-07-02

- v1.3.6 としてリリース
- エディター画面で、選択領域作成後、すぐに解除される不具合を解消した。エディターから myclicked signal が出され、それを拾って「検索」widget を閉じて解除していたが、「検索」widget が開かれてないときにも解除されていたのが原因。
- procedure に変数名を与えた時の挙動を勘違いしていたため修正。procedure に変数名が与えられたときには、procedure 実行後の環境の値が代入されるようにした。確か、以前はこれで作成したけれど、参照呼びにすべきと勘違いしてしまっていた。



2021-07-01

- 変数の初期状態設定ドックにコンテキストメニューを加え、右クリックで設定行が削除できるようにした。



2021-06-28

- v1.3.5 としてリリース
- 検索機能を追加
- 変数の初期状態を設定できるようにした
- 将来の拡張を見据えて、one-step 実行 history に SECD を含めるようにした。
- [TODO]
  - 置換機能の実装
  - 文法の見直し（学習コストをなるべく低くする方針で）



2021-06-18

- v1.3.4 としてリリース
- メニュー周りの改善
- border が微妙に空いていたので margin:0 にした



2021-06-17
- v1.3.3 としてリリース
- デバッグでのハイライト表示をわかりやすくするため、
　前の行から次の行へのトレースアニメーションを加えてみた。

2021-06-16

- v1.3.2 としてリリース
- 負の値を文法エラーにした。
- () や [] のオートコンプリートを行末だけで有効にした。



2021-06-15

- v1.x 系はこれで完成版としたい。v2.x 系では言語仕様を少し変更して（例えば := ではなく = を使うなど）メジャーアップデートとする。Undo、Redo、Search などのエディタ機能は、おいおい追加する。
- v1.3.1 としてリリース
- 文末に \ があれば、行を継続するようにした。
- begin end の自動挿入が行われる条件を見直し、同じインデントレベルで既に end がある場合には補間しないようにした。
- 未保存のままで他のファイルを開いたとき、未保存の性質が引き継がれてしまっていた不具合を解消した（window タイトルを変更しただけでも modified とみなされてしまうらしい）。
- 実行時のハイライトを cursor.setBlockFormat で指定していたが、この指定によって modified と見なされてしまっていた。代わりに QTextEdit.ExtraSelection を使うことで modified が検出されないようにした。



2021-06-14

- v1.3 としてリリース
- whileプログラムの解釈に使っていたスタックの実行を見直し、SECDマシン準拠となるようにした（Stack に積む操作も Code に落とすようにした）。これで、解釈エラーがポロポロと出なくなるはず。
- 名前呼びについても、adhoc に whileプログラムのコードを入れ込むのではなく、引数と与えられた変数の参照関係を見るようにした（なお、2連鎖以上は未実装）。
- len, left, right, mid, int, str を実装した。
- シンタックスハイライトを導入した。多分、見やすくなったと思う。
- begin と入力すると end が自動的に挿入されるようにした。同様に、(), []、"" の自動挿入にも対応した。
- タブを使うのをやめ、すべてスペース4文字で置き換えるようにした。



2021-06-12

- 配列、文字列の長さを取得する関数 len を buit-in として実装した。
- Shift+Tab でインデント操作ができるようにした。
- 選択領域に対しても Tab、Shift+Tab が行えるようにした。
- 改行をしたとき、前の行が `begin' で終わっているときには自動的に \t を入れてインデントするようにした。


- 2021-06-11
  - 演算子の結合の強さが PLY でうまく定義できていなかったので修正した（1 < 5-2  が (1<5) - 2 と解釈されていた）。
  - ついでに IF-THEN-ELSE の shift/reduce conflict も解消した。
  - ドラッグ＆ドロップでファイルがオープンできるようにした。



2021-06-10

- print文や深い array などで、式が与えられると正しく評価されない不具合を解消した。



2021-06-09

- ファイルメニューに「新規作成」などの定番操作を加えた。
- ツールバーにもそれらのアイコンを加えた。



2021-06-07

- v1.2 としてリリース
- デバッグモード用のドッグを追加し、1行ずつ実行できるようにした。
- Procedure への名前受け渡しの不具合を修正した。
- 深い配列（例えば a[2][1][4] など）への代入の不具合を修正した。



2021-05-29

- 書籍では、各変数の初期状態は 0 になっているため、まだ使われていない変数が参照されたときには 0 が代入されているものとして処理するようにしている。しかし、まだ使われていない変数 a に対して a++ が実行されると、環境の参照エラーとなってしまっていた。このバグを修正した。



2021-05-27

- v1.1 としてリリース
- GUI 版を作成した。
- GUI版では一つの文しか受け付けないようにし、複数の文を入力するときには複合文 begin～end を使うようにした（文法的にはこちらの方が正しい）。



2021-02-06

- v1.0 としてリリース
- 結果出力のインデントが、9行目にも関わらず 10行目のものとなっていたので修正した。



2021-02-05

- eval_sentence を再帰版に戻した。
また、procedure の呼び出しを「文」ではなく「式」として扱うようにした。



2021-01-25

- While言語のインタプリタ eval（再帰的定義版）の例を少しだけ複雑にした。



2021-01-14

- print文にて文字列の表示が行えなかったので修正した。



2020-12-20

- 配布版に含まれている不要なライブラリを削除した。



2020-01-20

- 配列の表示を Python dic形式から
[a,b,c] 形式に変更した
（pretty_print_val が担当）。

- [今後の課題]
  - 手続き呼び出しの入れ子を許可するようにする。



2020-01-18

- 文を解釈する eval_sentence() から
再帰呼び出しを除去した。
これは、テキストの万能プログラム U から
再帰呼び出しを除去する方法のチェックも兼ねている。

- [今後の課題]
  - 配列の表示を [a,b,c] にする。
  - 手続き呼び出しの入れ子を許可するようにする。



2019-11-25

- procedure の呼出し処理におけるローカル変数の保存を stack で行うことにした

- [今後の課題]
  - 配列の表示を [a,b,c] にする。
  - 配列に対しての組み込み関数 len, reverse, push, pop を用意する。



2018-11-02

- 配列、文字列を追加
- IF-THEN-ELSE が解釈されないバグを解消
